<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zach Workout App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
    }
    header {
      padding: 16px 24px;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.03em;
    }
    header span {
      font-size: 12px;
      color: #9ca3af;
    }
    @media (max-width: 600px) {
      header {
        padding: 12px 12px;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      header h1 {
        font-size: 18px;
      }
    }

    .top-tabs {
      display: flex;
      gap: 4px;
      padding: 8px 16px 0 16px;
      border-bottom: 1px solid #1f2937;
      background: #020617;
    }
    .top-tab {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #9ca3af;
      cursor: pointer;
    }
    .top-tab.active {
      background: #1d4ed8;
      border-color: #1d4ed8;
      color: #e5e7eb;
    }

    main {
      padding: 16px 16px 24px 16px;
      max-width: 1100px;
      margin: 0 auto;
    }

    .view-settings {
      display: grid;
      grid-template-columns: 3fr 2fr;
      gap: 24px;
    }
    @media (max-width: 900px) {
      .view-settings {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #020617;
      border-radius: 12px;
      border: 1px solid #1f2937;
      padding: 16px 18px 18px 18px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.7);
    }
    .card h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
    }
    .muted {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    .controls-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    label {
      font-size: 12px;
      color: #9ca3af;
    }
    select, input[type="number"], input[type="text"] {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #1f2937;
      border-radius: 6px;
      padding: 4px 6px;
      font-size: 13px;
    }
    select:focus, input:focus {
      outline: 1px solid #3b82f6;
      border-color: #3b82f6;
    }
    input[type="text"] {
      min-width: 140px;
    }
    button {
      border-radius: 6px;
      border: 1px solid transparent;
      padding: 5px 10px;
      font-size: 13px;
      cursor: pointer;
      background: #1d4ed8;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    button.secondary {
      background: #020617;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    button.danger {
      background: #7f1d1d;
      border-color: #b91c1c;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .tabs {
      display: inline-flex;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      padding: 2px;
      margin-left: auto;
    }
    .tab {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      cursor: pointer;
      border: none;
      background: transparent;
      color: #9ca3af;
    }
    .tab.active {
      background: #1d4ed8;
      color: #e5e7eb;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 12px;
      table-layout: auto;
    }
    th, td {
      padding: 4px 4px;
      border-bottom: 1px solid #1f2937;
      text-align: left;
    }
    th {
      font-weight: 500;
      color: #9ca3af;
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tbody tr:nth-child(even) {
      background: #020617;
    }
    tbody tr:nth-child(odd) {
      background: #020617;
    }

    .set-index-cell {
      width: 32px;
      text-align: right;
      color: #6b7280;
      white-space: nowrap;
    }
    .muscle-cell {
      width: 90px;
      white-space: nowrap;
    }
    .exercise-cell {
      width: auto;
      max-width: 260px;
    }
    .number-cell {
      width: 60px;
      white-space: nowrap;
    }
    .action-cell {
      width: 40px;
      text-align: right;
      white-space: nowrap;
    }

    table input[type="number"] {
      width: 60px;
      color: #9ca3af;
    }

    .pill {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #1f2937;
    }
    .pill.ok {
      background: #064e3b;
      border-color: #047857;
      color: #bbf7d0;
    }
    .pill.high {
      background: #7f1d1d;
      border-color: #b91c1c;
      color: #fecaca;
    }
    .pill.low {
      background: #312e81;
      border-color: #4f46e5;
      color: #e0e7ff;
    }
    .volume-table td {
      padding-top: 3px;
      padding-bottom: 3px;
    }
    .volume-table tbody tr:hover {
      background: #020617;
    }
    .small-note {
      font-size: 11px;
      color: #6b7280;
      margin-top: 6px;
    }
    .code-hint {
      font-size: 11px;
      color: #6b7280;
      margin-top: 10px;
      border-top: 1px dashed #1f2937;
      padding-top: 6px;
    }
    .day-toggle-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }
    .day-toggle-btn {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #9ca3af;
      cursor: pointer;
    }
    .day-toggle-btn.active {
      background: #1d4ed8;
      border-color: #1d4ed8;
      color: #e5e7eb;
    }

    /* Current Workout view */
    #workoutView .card {
      max-width: 520px;
      margin: 8px auto 0;
      padding: 10px 8px 12px 8px;
    }
    #workoutView h2 {
      font-size: 15px;
      margin-bottom: 4px;
    }
    #workoutView .controls-row {
      margin-bottom: 6px;
      gap: 6px;
    }
    #workoutView select {
      font-size: 12px;
      padding: 3px 5px;
    }
    #workoutContext {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    #workoutView th,
    #workoutView td {
      padding-top: 3px;
      padding-bottom: 3px;
    }
    #workoutView .small-note {
      margin-top: 4px;
    }

    .workout-table {
      width: 100%;
      table-layout: fixed;
      margin-left: 0;
    }
    .workout-table .exercise-cell {
      width: 65%;
      max-width: none;
      white-space: normal;
    }
    .workout-table .number-cell {
      width: 17%;
    }

    @media (max-width: 600px) {
      #workoutView .card {
        max-width: 100%;
        margin: 8px 0 0 0;
        border-radius: 0;
        box-shadow: none;
      }
      #workoutView .controls-row {
        flex-wrap: wrap;
      }
      #workoutView .tabs {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Zach Workout App</h1>
      <span>Multiple programs, adjustable days, up to 6 weeks, all saved locally</span>
    </div>
  </header>

  <nav class="top-tabs">
    <button id="workoutTabBtn" class="top-tab active">Current Workout</button>
    <button id="settingsTabBtn" class="top-tab">Settings</button>
  </nav>

  <main>
    <!-- SETTINGS VIEW -->
    <div id="settingsView" class="view-settings" style="display:none;">
      <section class="card">
        <div class="controls-row">
          <div>
            <label for="programSelect">Program</label><br />
            <select id="programSelect"></select>
          </div>
          <div>
            <label for="programNameInput">Name</label><br />
            <input id="programNameInput" type="text" />
          </div>
          <div style="margin-left:auto; display:flex; gap:6px; flex-wrap:wrap;">
            <button id="newProgramBtn" class="secondary">+ New program</button>
            <button id="deleteProgramBtn" class="danger">Delete</button>
          </div>
        </div>

        <div class="controls-row">
          <div>
            <label>Days in this program</label><br />
            <div id="dayToggleRow" class="day-toggle-row"></div>
          </div>
        </div>

        <div class="controls-row">
          <div>
            <label for="weekSelect">Week</label><br />
            <select id="weekSelect">
              <option value="Week 1">Week 1</option>
              <option value="Week 2">Week 2</option>
              <option value="Week 3">Week 3</option>
              <option value="Week 4">Week 4</option>
              <option value="Week 5">Week 5</option>
              <option value="Week 6">Week 6</option>
            </select>
          </div>
          <div style="margin-left:auto;">
            <div class="tabs" id="dayTabs"></div>
          </div>
        </div>

        <p class="muted">
          Each program can have custom days and up to six weeks. Each row is one set. Changes are saved automatically to your browser.
        </p>

        <div style="max-height: 360px; overflow: auto; border-radius: 8px; border: 1px solid #1f2937;">
          <table id="setsTable">
            <thead>
              <tr>
                <th class="set-index-cell">Set</th>
                <th class="muscle-cell">Muscle</th>
                <th class="exercise-cell">Exercise</th>
                <th class="number-cell">Weight</th>
                <th class="number-cell">Reps</th>
                <th class="action-cell"></th>
              </tr>
            </thead>
            <tbody id="setsTableBody"></tbody>
          </table>
        </div>

        <div style="margin-top: 10px; display: flex; justify-content: space-between; gap: 8px; align-items: center;">
          <button id="addSetBtn">+ Add set</button>
          <span class="small-note">
            To change defaults, edit <code>initialAppState</code> and <code>seedWeeks</code> inside this file.
          </span>
        </div>
      </section>

      <section class="card">
        <h2>Weekly Volume (sets per muscle)</h2>
        <p class="muted">
          Based on all sets in the selected program and week. Only active days count toward volume.
        </p>
        <div style="max-height: 330px; overflow: auto; border-radius: 8px; border: 1px solid #1f2937;">
          <table class="volume-table">
            <thead>
              <tr>
                <th>Muscle</th>
                <th>Ideal</th>
                <th>Actual</th>
                <th>Diff</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="volumeTableBody"></tbody>
          </table>
        </div>

        <div class="code-hint">
          Dev hint: programs live in <code>appState.programs</code>.<br/>
          Volume is computed in <code>computeVolumeForWeek</code> using the active days for each program.
        </div>
      </section>
    </div>

    <!-- CURRENT WORKOUT VIEW -->
    <div id="workoutView">
      <section class="card">
        <h2>Current Workout</h2>

        <div class="controls-row">
          <div>
            <label for="programSelectWorkout">Program</label><br />
            <select id="programSelectWorkout"></select>
          </div>
          <div>
            <label for="weekSelectWorkout">Week</label><br />
            <select id="weekSelectWorkout">
              <option value="Week 1">Week 1</option>
              <option value="Week 2">Week 2</option>
              <option value="Week 3">Week 3</option>
              <option value="Week 4">Week 4</option>
              <option value="Week 5">Week 5</option>
              <option value="Week 6">Week 6</option>
            </select>
          </div>
          <div style="margin-left:auto;">
            <div class="tabs" id="dayTabsWorkout"></div>
          </div>
        </div>

        <div id="workoutContext"></div>

        <div style="max-height: 380px; overflow: auto; border-radius: 8px; border: 1px solid #1f2937;">
          <table class="workout-table">
            <thead>
              <tr>
                <th class="exercise-cell">Exercise</th>
                <th class="number-cell">Weight</th>
                <th class="number-cell">Reps</th>
              </tr>
            </thead>
            <tbody id="workoutTableBody"></tbody>
          </table>
        </div>

        <p class="small-note">
          This view is for in-gym logging. Weight and reps start from your plan and can be adjusted on the fly.
        </p>
      </section>
    </div>
  </main>

  <script>
    const muscleGroups = [
      "Chest",
      "Back",
      "Triceps",
      "Biceps",
      "Shoulders",
      "Quads",
      "Glutes",
      "Hamstrings",
      "Calves",
      "Forearms"
    ];

    const idealSets = {
      "Chest": 4,
      "Back": 4,
      "Triceps": 11,
      "Biceps": 15,
      "Shoulders": 15,
      "Quads": 4,
      "Glutes": 4,
      "Hamstrings": 1,
      "Calves": 4,
      "Forearms": 9
    };

    const exerciseCatalog = [
      { "muscle": "Triceps", "name": "Cable Overhead Triceps Extension (Rope)" },
      { "muscle": "Triceps", "name": "Cable Triceps Pushdown (Single Arm)" },
      { "muscle": "Triceps", "name": "Dumbbell Overhead Extension (Two-Arms)" },
      { "muscle": "Triceps", "name": "Dip (Triceps-Focused)" },
      { "muscle": "Biceps", "name": "Dumbbell Curl (Incline)" },
      { "muscle": "Biceps", "name": "Cable Curl (EZ Bar, Wide Grip)" },
      { "muscle": "Biceps", "name": "Cable Rope Twist Curl" },
      { "muscle": "Biceps", "name": "Freemotion Curl (Single-Arm)" },
      { "muscle": "Shoulders", "name": "Cable Leaning Lateral Raise" },
      { "muscle": "Shoulders", "name": "Cable Single Arm Rear Delt Raise" },
      { "muscle": "Shoulders", "name": "Dumbbell Lateral Raise" },
      { "muscle": "Forearms", "name": "Barbell Standing Wrist Curl" },
      { "muscle": "Glutes", "name": "Deadlift" },
      { "muscle": "Glutes", "name": "Cable Pull Through" },
      { "muscle": "Chest", "name": "Bench Press (Wide Grip)" },
      { "muscle": "Chest", "name": "Dumbbell Flye (Flat)" },
      { "muscle": "Back", "name": "Pulldown (Straight Arm)" },
      { "muscle": "Back", "name": "Pullup (Rings)" },
      { "muscle": "Quads", "name": "Barbell Squat (High Bar)" },
      { "muscle": "Quads", "name": "Goblet Squat" },
      { "muscle": "Calves", "name": "Stair Calves (Single Leg)" },
      { "muscle": "Hamstrings", "name": "Stiff-Legged Dead Lift" }
    ];

    const ALL_DAYS = [
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday",
      "Sunday"
    ];

    const DEFAULT_ACTIVE_DAYS = [
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday"
    ];

    const seedWeek1 = {
      "Monday": [
        { "exercise": "Cable Overhead Triceps Extension (Rope)", "muscle": "Triceps", "weight": 40, "reps": 13 },
        { "exercise": "Cable Overhead Triceps Extension (Rope)", "muscle": "Triceps", "weight": 40, "reps": 13 },
        { "exercise": "Cable Overhead Triceps Extension (Rope)", "muscle": "Triceps", "weight": 40, "reps": 13 },
        { "exercise": "Bench Press (Wide Grip)", "muscle": "Chest", "weight": 175, "reps": 11 },
        { "exercise": "Bench Press (Wide Grip)", "muscle": "Chest", "weight": 175, "reps": 11 },
        { "exercise": "Pulldown (Straight Arm)", "muscle": "Back", "weight": 50, "reps": 11 },
        { "exercise": "Pulldown (Straight Arm)", "muscle": "Back", "weight": 50, "reps": 11 },
        { "exercise": "Dumbbell Curl (Incline)", "muscle": "Biceps", "weight": 25, "reps": 14 },
        { "exercise": "Dumbbell Curl (Incline)", "muscle": "Biceps", "weight": 25, "reps": 14 },
        { "exercise": "Dumbbell Curl (Incline)", "muscle": "Biceps", "weight": 25, "reps": 14 },
        { "exercise": "Cable Leaning Lateral Raise", "muscle": "Shoulders", "weight": 5, "reps": 13 },
        { "exercise": "Cable Leaning Lateral Raise", "muscle": "Shoulders", "weight": 5, "reps": 13 },
        { "exercise": "Cable Leaning Lateral Raise", "muscle": "Shoulders", "weight": 5, "reps": 13 },
        { "exercise": "Barbell Standing Wrist Curl", "muscle": "Forearms", "weight": 45, "reps": 18 },
        { "exercise": "Barbell Standing Wrist Curl", "muscle": "Forearms", "weight": 45, "reps": 18 },
        { "exercise": "Barbell Standing Wrist Curl", "muscle": "Forearms", "weight": 45, "reps": 18 }
      ],
      "Tuesday": [
        { "exercise": "Deadlift", "muscle": "Glutes", "weight": 315, "reps": 7 },
        { "exercise": "Deadlift", "muscle": "Glutes", "weight": 315, "reps": 7 },
        { "exercise": "Deadlift", "muscle": "Glutes", "weight": 315, "reps": 7 },
        { "exercise": "Barbell Squat (High Bar)", "muscle": "Quads", "weight": 225, "reps": 11 },
        { "exercise": "Barbell Squat (High Bar)", "muscle": "Quads", "weight": 225, "reps": 11 },
        { "exercise": "Goblet Squat", "muscle": "Quads", "weight": 45, "reps": 13 },
        { "exercise": "Goblet Squat", "muscle": "Quads", "weight": 45, "reps": 13 },
        { "exercise": "Stair Calves (Single Leg)", "muscle": "Calves", "weight": 0, "reps": 15 },
        { "exercise": "Stair Calves (Single Leg)", "muscle": "Calves", "weight": 0, "reps": 15 }
      ],
      "Wednesday": [
        { "exercise": "Cable Triceps Pushdown (Single Arm)", "muscle": "Triceps", "weight": 20, "reps": 13 },
        { "exercise": "Cable Triceps Pushdown (Single Arm)", "muscle": "Triceps", "weight": 20, "reps": 13 },
        { "exercise": "Cable Triceps Pushdown (Single Arm)", "muscle": "Triceps", "weight": 20, "reps": 13 },
        { "exercise": "Dumbbell Flye (Flat)", "muscle": "Chest", "weight": 40, "reps": 13 },
        { "exercise": "Dumbbell Flye (Flat)", "muscle": "Chest", "weight": 40, "reps": 13 },
        { "exercise": "Pullup (Rings)", "muscle": "Back", "weight": 0, "reps": 7 },
        { "exercise": "Pullup (Rings)", "muscle": "Back", "weight": 0, "reps": 7 },
        { "exercise": "Cable Rope Twist Curl", "muscle": "Biceps", "weight": 20, "reps": 13 },
        { "exercise": "Cable Rope Twist Curl", "muscle": "Biceps", "weight": 20, "reps": 13 },
        { "exercise": "Cable Rope Twist Curl", "muscle": "Biceps", "weight": 20, "reps": 13 },
        { "exercise": "Cable Single Arm Rear Delt Raise", "muscle": "Shoulders", "weight": 5, "reps": 13 },
        { "exercise": "Cable Single Arm Rear Delt Raise", "muscle": "Shoulders", "weight": 5, "reps": 13 },
        { "exercise": "Cable Single Arm Rear Delt Raise", "muscle": "Shoulders", "weight": 5, "reps": 13 },
        { "exercise": "Stiff-Legged Dead Lift", "muscle": "Hamstrings", "weight": 220, "reps": 9 },
        { "exercise": "Stiff-Legged Dead Lift", "muscle": "Hamstrings", "weight": 220, "reps": 9 },
        { "exercise": "Stiff-Legged Dead Lift", "muscle": "Hamstrings", "weight": 220, "reps": 9 },
        { "exercise": "Stiff-Legged Dead Lift", "muscle": "Hamstrings", "weight": 220, "reps": 9 }
      ],
      "Thursday": [
        { "exercise": "Dip (Triceps-Focused)", "muscle": "Triceps", "weight": 0, "reps": 14 },
        { "exercise": "Dip (Triceps-Focused)", "muscle": "Triceps", "weight": 0, "reps": 14 },
        { "exercise": "Dip (Triceps-Focused)", "muscle": "Triceps", "weight": 0, "reps": 14 },
        { "exercise": "Bench Press (Wide Grip)", "muscle": "Chest", "weight": 155, "reps": 13 },
        { "exercise": "Bench Press (Wide Grip)", "muscle": "Chest", "weight": 155, "reps": 13 },
        { "exercise": "Pulldown (Straight Arm)", "muscle": "Back", "weight": 40, "reps": 13 },
        { "exercise": "Pulldown (Straight Arm)", "muscle": "Back", "weight": 40, "reps": 13 },
        { "exercise": "Dumbbell Curl (Incline)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Dumbbell Curl (Incline)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Dumbbell Curl (Incline)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Cable Leaning Lateral Raise", "muscle": "Shoulders", "weight": 5, "reps": 11 }
      ],
      "Friday": [
        { "exercise": "Dumbbell Overhead Extension (Two-Arms)", "muscle": "Triceps", "weight": 10, "reps": 15 },
        { "exercise": "Dumbbell Overhead Extension (Two-Arms)", "muscle": "Triceps", "weight": 10, "reps": 15 },
        { "exercise": "Dumbbell Overhead Extension (Two-Arms)", "muscle": "Triceps", "weight": 10, "reps": 15 },
        { "exercise": "Barbell Squat (High Bar)", "muscle": "Quads", "weight": 205, "reps": 11 },
        { "exercise": "Barbell Squat (High Bar)", "muscle": "Quads", "weight": 205, "reps": 11 },
        { "exercise": "Barbell Squat (High Bar)", "muscle": "Quads", "weight": 205, "reps": 11 },
        { "exercise": "Goblet Squat", "muscle": "Quads", "weight": 45, "reps": 13 },
        { "exercise": "Goblet Squat", "muscle": "Quads", "weight": 45, "reps": 13 },
        { "exercise": "Goblet Squat", "muscle": "Quads", "weight": 45, "reps": 13 },
        { "exercise": "Stair Calves (Single Leg)", "muscle": "Calves", "weight": 0, "reps": 15 },
        { "exercise": "Stair Calves (Single Leg)", "muscle": "Calves", "weight": 0, "reps": 15 },
        { "exercise": "Stair Calves (Single Leg)", "muscle": "Calves", "weight": 0, "reps": 15 },
        { "exercise": "Freemotion Curl (Single-Arm)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Freemotion Curl (Single-Arm)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Freemotion Curl (Single-Arm)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Freemotion Curl (Single-Arm)", "muscle": "Biceps", "weight": 20, "reps": 11 },
        { "exercise": "Freemotion Curl (Single-Arm)", "muscle": "Biceps", "weight": 20, "reps": 11 }
      ],
      "Saturday": [],
      "Sunday": []
    };

    function emptyWeek() {
      const w = {};
      ALL_DAYS.forEach(day => {
        w[day] = [];
      });
      return w;
    }

    function makeEmptyWeeks() {
      return {
        "Week 1": emptyWeek(),
        "Week 2": emptyWeek(),
        "Week 3": emptyWeek(),
        "Week 4": emptyWeek(),
        "Week 5": emptyWeek(),
        "Week 6": emptyWeek()
      };
    }

    const seedWeeks = {
      "Week 1": seedWeek1,
      "Week 2": emptyWeek(),
      "Week 3": emptyWeek(),
      "Week 4": emptyWeek(),
      "Week 5": emptyWeek(),
      "Week 6": emptyWeek()
    };

    const initialAppState = {
      currentProgramId: "prog-default",
      programs: [
        {
          id: "prog-default",
          name: "Default Program",
          days: DEFAULT_ACTIVE_DAYS.slice(),
          weeks: makeEmptyWeeks()
        },
        {
          id: "prog-arms",
          name: "Arms & Shoulders",
          days: DEFAULT_ACTIVE_DAYS.slice(),
          weeks: seedWeeks
        }
      ]
    };

    const STORAGE_KEY = "zachWorkoutPrograms_v1";
    const MIGRATION_KEY = "zachWorkoutArmsShouldersMigrated_v1";

    function deepClone(obj) {
      return JSON.parse(JSON.stringify(obj));
    }

    function normalizeDays(days) {
      if (!Array.isArray(days) || !days.length) {
        return DEFAULT_ACTIVE_DAYS.slice();
      }
      const set = new Set(days);
      const normalized = ALL_DAYS.filter(d => set.has(d));
      return normalized.length ? normalized : DEFAULT_ACTIVE_DAYS.slice();
    }

    function migrateArmsShoulders(state) {
      try {
        if (window.localStorage.getItem(MIGRATION_KEY) === "1") {
          return state;
        }
      } catch (e) {
        return state;
      }

      if (!state || !state.programs || !state.programs.length) return state;

      const programs = state.programs;
      const hasArms = programs.some(p => p.name === "Arms & Shoulders");
      if (hasArms) {
        try { window.localStorage.setItem(MIGRATION_KEY, "1"); } catch (e) {}
        return state;
      }

      let defaultProg = programs.find(p => p.name === "Default Program") || programs[0];
      if (!defaultProg) return state;

      const arms = deepClone(defaultProg);
      arms.id = "prog-arms-" + Date.now().toString(36);
      arms.name = "Arms & Shoulders";
      programs.push(arms);

      const clearedWeeks = makeEmptyWeeks();
      defaultProg.weeks = clearedWeeks;
      defaultProg.days = normalizeDays(defaultProg.days);

      state.currentProgramId = defaultProg.id;

      try { window.localStorage.setItem(MIGRATION_KEY, "1"); } catch (e) {}
      return state;
    }

    function loadAppState() {
      try {
        const raw = window.localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          const cloned = deepClone(initialAppState);
          return cloned;
        }
        const parsed = JSON.parse(raw);
        if (!parsed.programs || !parsed.programs.length) {
          return deepClone(initialAppState);
        }
        parsed.programs.forEach(p => {
          p.days = normalizeDays(p.days);
          if (!p.weeks) {
            p.weeks = makeEmptyWeeks();
          }
        });
        return migrateArmsShoulders(parsed);
      } catch (e) {
        return deepClone(initialAppState);
      }
    }

    function saveAppState() {
      try {
        window.localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
      } catch (e) {
        console.warn("Failed to save app state.", e);
      }
    }

    function getExercisesForMuscle(muscle) {
      return exerciseCatalog.filter(e => e.muscle === muscle);
    }

    function getCurrentProgram() {
      return appState.programs.find(p => p.id === appState.currentProgramId) || appState.programs[0];
    }

    function ensureWeekAndDaysExist(program, weekKey) {
      if (!program.weeks) {
        program.weeks = makeEmptyWeeks();
      }
      if (!program.weeks[weekKey]) {
        program.weeks[weekKey] = emptyWeek();
      }
      ALL_DAYS.forEach(day => {
        if (!program.weeks[weekKey][day]) {
          program.weeks[weekKey][day] = [];
        }
      });
    }

    function computeVolumeForWeek(program, weekKey) {
      const result = {};
      muscleGroups.forEach(m => { result[m] = 0; });

      if (!program.weeks || !program.weeks[weekKey]) return result;

      const activeDays = normalizeDays(program.days);
      const weekData = program.weeks[weekKey];

      activeDays.forEach(day => {
        const dayArray = weekData[day] || [];
        dayArray.forEach(set => {
          const m = set.muscle;
          if (!m) return;
          if (!(m in result)) result[m] = 0;
          result[m] += 1;
        });
      });

      return result;
    }

    function attachClearOnType(input) {
      input.dataset.cleared = "false";
      input.addEventListener("keydown", (e) => {
        if (input.dataset.cleared === "true") return;
        if (
          e.key === "ArrowUp" ||
          e.key === "ArrowDown" ||
          e.key === "Tab" ||
          e.key === "Shift" ||
          e.key === "Control" ||
          e.key === "Alt" ||
          e.key === "Meta"
        ) {
          return;
        }
        input.value = "";
        input.dataset.cleared = "true";
      });
    }

    function attachEditedColor(input) {
      input.dataset.edited = "false";
      input.addEventListener("input", () => {
        if (input.dataset.edited === "false") {
          input.style.color = "#e5e7eb";
          input.dataset.edited = "true";
        }
      });
    }

    const settingsTabBtn = document.getElementById("settingsTabBtn");
    const workoutTabBtn = document.getElementById("workoutTabBtn");
    const settingsViewEl = document.getElementById("settingsView");
    const workoutViewEl = document.getElementById("workoutView");

    const programSelectEl = document.getElementById("programSelect");
    const programNameInputEl = document.getElementById("programNameInput");
    const newProgramBtn = document.getElementById("newProgramBtn");
    const deleteProgramBtn = document.getElementById("deleteProgramBtn");

    const dayToggleRowEl = document.getElementById("dayToggleRow");

    const weekSelectEl = document.getElementById("weekSelect");
    const dayTabsEl = document.getElementById("dayTabs");
    const setsTableBodyEl = document.getElementById("setsTableBody");
    const volumeTableBodyEl = document.getElementById("volumeTableBody");
    const addSetBtn = document.getElementById("addSetBtn");

    const workoutTableBodyEl = document.getElementById("workoutTableBody");
    const workoutContextEl = document.getElementById("workoutContext");

    const programSelectWorkoutEl = document.getElementById("programSelectWorkout");
    const weekSelectWorkoutEl = document.getElementById("weekSelectWorkout");
    const dayTabsWorkoutEl = document.getElementById("dayTabsWorkout");

    let appState = loadAppState();
    let currentWeek = "Week 1";
    let currentDay = "Monday";
    let currentView = "workout";

    function setView(view) {
      currentView = view;
      if (view === "settings") {
        settingsViewEl.style.display = "grid";
        workoutViewEl.style.display = "none";
        settingsTabBtn.classList.add("active");
        workoutTabBtn.classList.remove("active");
      } else {
        settingsViewEl.style.display = "none";
        workoutViewEl.style.display = "block";
        settingsTabBtn.classList.remove("active");
        workoutTabBtn.classList.add("active");
      }
    }

    settingsTabBtn.addEventListener("click", () => setView("settings"));
    workoutTabBtn.addEventListener("click", () => setView("workout"));

    function renderWeekSelects() {
      weekSelectEl.value = currentWeek;
      weekSelectWorkoutEl.value = currentWeek;
    }

    function renderProgramSelect() {
      programSelectEl.innerHTML = "";
      programSelectWorkoutEl.innerHTML = "";

      appState.programs.forEach(p => {
        const opt1 = document.createElement("option");
        opt1.value = p.id;
        opt1.textContent = p.name || "Unnamed program";
        if (p.id === appState.currentProgramId) opt1.selected = true;
        programSelectEl.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = p.id;
        opt2.textContent = p.name || "Unnamed program";
        if (p.id === appState.currentProgramId) opt2.selected = true;
        programSelectWorkoutEl.appendChild(opt2);
      });

      const program = getCurrentProgram();
      if (program) {
        programNameInputEl.value = program.name || "";
      }
      renderDayToggles();
      renderWorkoutContext();
    }

    function renderDayToggles() {
      const program = getCurrentProgram();
      if (!program) return;
      const activeDays = normalizeDays(program.days);
      program.days = activeDays;
      dayToggleRowEl.innerHTML = "";
      ALL_DAYS.forEach(day => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = day.slice(0, 3);
        btn.className = "day-toggle-btn";
        if (activeDays.includes(day)) {
          btn.classList.add("active");
        }
        btn.addEventListener("click", () => {
          const isActive = activeDays.includes(day);
          if (isActive) {
            if (activeDays.length === 1) {
              return;
            }
            const idx = activeDays.indexOf(day);
            activeDays.splice(idx, 1);
          } else {
            activeDays.push(day);
            const order = new Map();
            ALL_DAYS.forEach((d, i) => order.set(d, i));
            activeDays.sort((a, b) => order.get(a) - order.get(b));
          }
          program.days = activeDays.slice();
          if (!program.days.includes(currentDay)) {
            currentDay = program.days[0];
          }
          saveAppState();
          renderDayToggles();
          renderDayTabs();
          renderSetsTable();
          renderVolumeTable();
          renderWorkoutContext();
          renderWorkoutTable();
        });
        dayToggleRowEl.appendChild(btn);
      });
    }

    function renderDayTabs() {
      const program = getCurrentProgram();
      if (!program) return;
      const activeDays = normalizeDays(program.days);
      program.days = activeDays;
      if (!activeDays.includes(currentDay)) {
        currentDay = activeDays[0];
      }
      dayTabsEl.innerHTML = "";
      dayTabsWorkoutEl.innerHTML = "";
      activeDays.forEach(day => {
        const makeBtn = (container) => {
          const btn = document.createElement("button");
          btn.textContent = day.slice(0, 3);
          btn.className = "tab" + (day === currentDay ? " active" : "");
          btn.addEventListener("click", () => {
            currentDay = day;
            renderDayTabs();
            renderSetsTable();
            renderWorkoutContext();
            renderWorkoutTable();
          });
          container.appendChild(btn);
        };
        makeBtn(dayTabsEl);
        makeBtn(dayTabsWorkoutEl);
      });
    }

    function renderSetsTable() {
      const program = getCurrentProgram();
      ensureWeekAndDaysExist(program, currentWeek);
      const sets = program.weeks[currentWeek][currentDay];

      setsTableBodyEl.innerHTML = "";
      sets.forEach((set, index) => {
        const tr = document.createElement("tr");

        const tdIndex = document.createElement("td");
        tdIndex.className = "set-index-cell";
        tdIndex.textContent = index + 1;
        tr.appendChild(tdIndex);

        const tdMuscle = document.createElement("td");
        tdMuscle.className = "muscle-cell";
        const muscleSelect = document.createElement("select");
        muscleGroups.forEach(m => {
          const opt = document.createElement("option");
          opt.value = m;
          opt.textContent = m;
          if (set.muscle === m) opt.selected = true;
          muscleSelect.appendChild(opt);
        });
        muscleSelect.addEventListener("change", () => {
          set.muscle = muscleSelect.value;
          const exList = getExercisesForMuscle(set.muscle);
          if (!exList.find(e => e.name === set.exercise)) {
            set.exercise = exList.length ? exList[0].name : "";
          }
          saveAppState();
          renderSetsTable();
          renderVolumeTable();
          renderWorkoutTable();
        });
        tdMuscle.appendChild(muscleSelect);
        tr.appendChild(tdMuscle);

        const tdExercise = document.createElement("td");
        tdExercise.className = "exercise-cell";
        const exerciseSelect = document.createElement("select");
        const options = getExercisesForMuscle(set.muscle);
        if (!options.length && set.exercise) {
          const opt = document.createElement("option");
          opt.value = set.exercise;
          opt.textContent = set.exercise;
          exerciseSelect.appendChild(opt);
        } else {
          options.forEach(ex => {
            const opt = document.createElement("option");
            opt.value = ex.name;
            opt.textContent = ex.name;
            if (ex.name === set.exercise) opt.selected = true;
            exerciseSelect.appendChild(opt);
          });
        }
        exerciseSelect.addEventListener("change", () => {
          set.exercise = exerciseSelect.value;
          saveAppState();
          renderVolumeTable();
          renderWorkoutTable();
        });
        tdExercise.appendChild(exerciseSelect);
        tr.appendChild(tdExercise);

        const tdWeight = document.createElement("td");
        tdWeight.className = "number-cell";
        const weightInput = document.createElement("input");
        weightInput.type = "number";
        weightInput.step = "5";
        const wVal = set.weight ?? "";
        weightInput.value = wVal;
        weightInput.placeholder = wVal;
        attachClearOnType(weightInput);
        attachEditedColor(weightInput);
        weightInput.addEventListener("input", () => {
          const v = weightInput.value;
          set.weight = v === "" ? null : Number(v);
          saveAppState();
          renderWorkoutTable();
          renderVolumeTable();
        });
        tdWeight.appendChild(weightInput);
        tr.appendChild(tdWeight);

        const tdReps = document.createElement("td");
        tdReps.className = "number-cell";
        const repsInput = document.createElement("input");
        repsInput.type = "number";
        repsInput.step = "1";
        const rVal = set.reps ?? "";
        repsInput.value = rVal;
        repsInput.placeholder = rVal;
        attachClearOnType(repsInput);
        attachEditedColor(repsInput);
        repsInput.addEventListener("input", () => {
          const v = repsInput.value;
          set.reps = v === "" ? null : Number(v);
          saveAppState();
          renderWorkoutTable();
          renderVolumeTable();
        });
        tdReps.appendChild(repsInput);
        tr.appendChild(tdReps);

        const tdAction = document.createElement("td");
        tdAction.className = "action-cell";
        const delBtn = document.createElement("button");
        delBtn.textContent = "✕";
        delBtn.className = "danger";
        delBtn.addEventListener("click", () => {
          program.weeks[currentWeek][currentDay].splice(index, 1);
          saveAppState();
          renderSetsTable();
          renderVolumeTable();
          renderWorkoutTable();
        });
        tdAction.appendChild(delBtn);
        tr.appendChild(tdAction);

        setsTableBodyEl.appendChild(tr);
      });
    }

    function renderVolumeTable() {
      const program = getCurrentProgram();
      const volume = computeVolumeForWeek(program, currentWeek);
      volumeTableBodyEl.innerHTML = "";
      muscleGroups.forEach(muscle => {
        const ideal = idealSets[muscle] ?? 0;
        const actual = volume[muscle] ?? 0;
        const diff = actual - ideal;

        const tr = document.createElement("tr");

        const tdMuscle = document.createElement("td");
        tdMuscle.textContent = muscle;
        tr.appendChild(tdMuscle);

        const tdIdeal = document.createElement("td");
        tdIdeal.textContent = ideal;
        tr.appendChild(tdIdeal);

        const tdActual = document.createElement("td");
        tdActual.textContent = actual;
        tr.appendChild(tdActual);

        const tdDiff = document.createElement("td");
        tdDiff.textContent = diff > 0 ? "+" + diff : diff;
        tr.appendChild(tdDiff);

        const tdStatus = document.createElement("td");
        const pill = document.createElement("span");
        pill.className = "pill";
        if (actual === ideal) {
          pill.classList.add("ok");
          pill.textContent = "On target";
        } else if (actual > ideal) {
          pill.classList.add("high");
          pill.textContent = "High";
        } else {
          pill.classList.add("low");
          pill.textContent = "Low";
        }
        tdStatus.appendChild(pill);
        tr.appendChild(tdStatus);

        volumeTableBodyEl.appendChild(tr);
      });
    }

    function renderWorkoutContext() {
      const program = getCurrentProgram();
      if (!program) {
        workoutContextEl.textContent = "";
        return;
      }
      workoutContextEl.textContent = `${program.name || "Program"} · ${currentWeek} · ${currentDay}`;
    }

    function renderWorkoutTable() {
      const program = getCurrentProgram();
      if (!program) {
        workoutTableBodyEl.innerHTML = "";
        return;
      }
      ensureWeekAndDaysExist(program, currentWeek);
      const sets = program.weeks[currentWeek][currentDay];

      workoutTableBodyEl.innerHTML = "";
      sets.forEach((set) => {
        const tr = document.createElement("tr");

        const tdExercise = document.createElement("td");
        tdExercise.className = "exercise-cell";
        tdExercise.textContent = set.exercise || "(select in Settings)";
        tr.appendChild(tdExercise);

        const tdWeight = document.createElement("td");
        tdWeight.className = "number-cell";
        const weightInput = document.createElement("input");
        const weightVal = set.weight ?? "";
        weightInput.type = "number";
        weightInput.step = "5";
        weightInput.value = weightVal;
        weightInput.placeholder = weightVal;
        attachClearOnType(weightInput);
        attachEditedColor(weightInput);
        weightInput.addEventListener("input", () => {
          const v = weightInput.value;
          set.weight = v === "" ? null : Number(v);
          saveAppState();
        });
        tdWeight.appendChild(weightInput);
        tr.appendChild(tdWeight);

        const tdReps = document.createElement("td");
        tdReps.className = "number-cell";
        const repsInput = document.createElement("input");
        const repsVal = set.reps ?? "";
        repsInput.type = "number";
        repsInput.step = "1";
        repsInput.value = repsVal;
        repsInput.placeholder = repsVal;
        attachClearOnType(repsInput);
        attachEditedColor(repsInput);
        repsInput.addEventListener("input", () => {
          const v = repsInput.value;
          set.reps = v === "" ? null : Number(v);
          saveAppState();
        });
        tdReps.appendChild(repsInput);
        tr.appendChild(tdReps);

        workoutTableBodyEl.appendChild(tr);
      });
    }

    function handleProgramChange(newId) {
      appState.currentProgramId = newId;
      saveAppState();
      const program = getCurrentProgram();
      if (program && !program.weeks) {
        program.weeks = makeEmptyWeeks();
      }
      const activeDays = normalizeDays(getCurrentProgram().days);
      if (!activeDays.includes(currentDay)) {
        currentDay = activeDays[0];
      }
      renderProgramSelect();
      renderWeekSelects();
      renderDayTabs();
      renderSetsTable();
      renderVolumeTable();
      renderWorkoutContext();
      renderWorkoutTable();
    }

    function handleWeekChange(newWeek) {
      currentWeek = newWeek;
      const program = getCurrentProgram();
      if (program) {
        ensureWeekAndDaysExist(program, currentWeek);
      }
      saveAppState();
      renderWeekSelects();
      renderSetsTable();
      renderVolumeTable();
      renderWorkoutContext();
      renderWorkoutTable();
    }

    programSelectEl.addEventListener("change", () => {
      handleProgramChange(programSelectEl.value);
    });

    programSelectWorkoutEl.addEventListener("change", () => {
      handleProgramChange(programSelectWorkoutEl.value);
    });

    programNameInputEl.addEventListener("input", () => {
      const program = getCurrentProgram();
      if (!program) return;
      program.name = programNameInputEl.value || "Unnamed program";
      saveAppState();
      renderProgramSelect();
      renderWorkoutContext();
    });

    newProgramBtn.addEventListener("click", () => {
      const baseProgram = getCurrentProgram();
      const cloneWeeks = baseProgram && baseProgram.weeks
        ? deepClone(baseProgram.weeks)
        : makeEmptyWeeks();

      const newId = "prog-" + Date.now().toString(36);
      const newProgram = {
        id: newId,
        name: (baseProgram?.name || "Program") + " copy",
        days: baseProgram?.days ? baseProgram.days.slice() : DEFAULT_ACTIVE_DAYS.slice(),
        weeks: cloneWeeks
      };
      appState.programs.push(newProgram);
      handleProgramChange(newId);
      currentWeek = "Week 1";
      currentDay = normalizeDays(newProgram.days)[0];
      renderWeekSelects();
    });

    deleteProgramBtn.addEventListener("click", () => {
      const program = getCurrentProgram();
      if (!program) return;
      const ok = window.confirm(`Delete program "${program.name}"? This cannot be undone.`);
      if (!ok) return;

      if (appState.programs.length === 1) {
        appState = deepClone(initialAppState);
      } else {
        appState.programs = appState.programs.filter(p => p.id !== program.id);
        appState.currentProgramId = appState.programs[0].id;
      }
      currentWeek = "Week 1";
      currentDay = "Monday";
      saveAppState();
      renderProgramSelect();
      renderWeekSelects();
      renderDayTabs();
      renderSetsTable();
      renderVolumeTable();
      renderWorkoutContext();
      renderWorkoutTable();
    });

    weekSelectEl.addEventListener("change", () => {
      handleWeekChange(weekSelectEl.value);
    });

    weekSelectWorkoutEl.addEventListener("change", () => {
      handleWeekChange(weekSelectWorkoutEl.value);
    });

    addSetBtn.addEventListener("click", () => {
      const program = getCurrentProgram();
      ensureWeekAndDaysExist(program, currentWeek);
      const sets = program.weeks[currentWeek][currentDay];
      let muscle = "Chest";
      let exerciseName = "";
      if (sets.length) {
        muscle = sets[sets.length - 1].muscle || muscle;
        exerciseName = sets[sets.length - 1].exercise || "";
      } else {
        const chestList = getExercisesForMuscle(muscle);
        if (chestList.length) exerciseName = chestList[0].name;
      }
      sets.push({
        muscle,
        exercise: exerciseName,
        weight: null,
        reps: null
      });
      saveAppState();
      renderSetsTable();
      renderVolumeTable();
      renderWorkoutTable();
    });

    function init() {
      const program = getCurrentProgram();
      if (!program) {
        appState = deepClone(initialAppState);
      } else {
        ensureWeekAndDaysExist(program, currentWeek);
        program.days = normalizeDays(program.days);
        if (!program.days.includes(currentDay)) {
          currentDay = program.days[0];
        }
      }
      renderProgramSelect();
      renderWeekSelects();
      renderDayTabs();
      renderSetsTable();
      renderVolumeTable();
      renderWorkoutContext();
      renderWorkoutTable();
      setView("workout");
    }

    init();
  </script>
</body>
</html>
